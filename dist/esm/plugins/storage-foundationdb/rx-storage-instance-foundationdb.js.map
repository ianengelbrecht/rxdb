{"version":3,"file":"rx-storage-instance-foundationdb.js","names":["Subject","getPrimaryFieldOfPrimaryKey","categorizeBulkWriteRows","CLEANUP_INDEX","FOUNDATION_DB_WRITE_BATCH_SIZE","getFoundationDBIndexName","getIndexableStringMonad","getStartIndexStringFromLowerBound","getStartIndexStringFromUpperBound","appendToArray","batchArray","ensureNotFalsy","lastOfArray","now","PROMISE_RESOLVE_VOID","toArray","queryFoundationDB","INDEX_MAX","attachmentMapKey","RxStorageInstanceFoundationDB","storage","databaseName","collectionName","schema","internals","options","settings","changes$","primaryPath","primaryKey","_proto","prototype","bulkWrite","documentWrites","context","dbs","dbsPromise","ret","success","error","writeBatches","Promise","all","map","writeBatch","categorized","root","doTransaction","tx","ids","row","document","mainTx","at","main","subspace","attachmentTx","attachments","docsInDB","Map","id","doc","get","set","errors","bulkInsertDocs","forEach","writeRow","docId","push","Object","values","indexes","indexMeta","indexString","getIndexableString","indexTx","db","bulkUpdateDocs","oldIndexString","previous","newIndexString","delete","attachmentsAdd","attachment","documentId","attachmentId","attachmentData","attachmentsUpdate","attachmentsRemove","eventBulk","events","length","lastState","newestRow","checkpoint","lwt","_meta","next","findDocumentsById","withDeleted","docInDb","_deleted","query","preparedQuery","count","result","documents","mode","info","totalCount","range","getRangeAll","getAttachmentData","_digest","data","getChangedDocumentsSince","limit","keySelector","StreamingMode","require","index","indexName","lowerBoundString","checkpointPartialDoc","innerResult","firstGreaterThan","streamingMode","Exact","docIds","docsData","lastDoc","changeStream","asObservable","remove","clearRange","close","cleanup","minimumDeletedTime","maxDeletionTime","upperBoundString","noMoreUndeleted","batchSize","pop","indexMetaInner","subIndexDB","docData","conflictResultionTasks","resolveConflictResultionTask","_taskSolution","closed","complete","createFoundationDBStorageInstance","params","open","directory","encoders","connection","clusterFile","dir","createOrOpen","version","withKeyEncoding","string","withValueEncoding","json","indexDBs","useIndexes","slice","useIndexesFinal","indexAr","unshift","indexDB","instance","resolve"],"sources":["../../../../src/plugins/storage-foundationdb/rx-storage-instance-foundationdb.ts"],"sourcesContent":["import { Observable, Subject } from 'rxjs';\nimport { getPrimaryFieldOfPrimaryKey } from '../../rx-schema-helper.ts';\nimport type {\n    BulkWriteRow,\n    CategorizeBulkWriteRowsOutput,\n    EventBulk,\n    RxAttachmentWriteData,\n    RxConflictResultionTask,\n    RxConflictResultionTaskSolution,\n    RxDocumentData,\n    RxJsonSchema,\n    RxStorageBulkWriteResponse,\n    RxStorageChangeEvent,\n    RxStorageCountResult,\n    RxStorageDefaultCheckpoint,\n    RxStorageInfoResult,\n    RxStorageInstance,\n    RxStorageInstanceCreationParams,\n    RxStorageQueryResult,\n    StringKeys\n} from '../../types/index.d.ts';\nimport type {\n    FoundationDBDatabase,\n    FoundationDBIndexMeta,\n    FoundationDBPreparedQuery,\n    FoundationDBStorageInternals,\n    RxStorageFoundationDB,\n    RxStorageFoundationDBInstanceCreationOptions,\n    RxStorageFoundationDBSettings\n} from './foundationdb-types.ts';\n// import {\n//     open as foundationDBOpen,\n//     directory as foundationDBDirectory,\n//     encoders as foundationDBEncoders,\n//     keySelector as foundationDBKeySelector,\n//     StreamingMode as foundationDBStreamingMode\n// } from 'foundationdb';\nimport {\n    categorizeBulkWriteRows\n} from '../../rx-storage-helper.ts';\nimport {\n\n    CLEANUP_INDEX,\n    FOUNDATION_DB_WRITE_BATCH_SIZE,\n    getFoundationDBIndexName\n} from './foundationdb-helpers.ts';\nimport {\n    getIndexableStringMonad,\n    getStartIndexStringFromLowerBound,\n    getStartIndexStringFromUpperBound\n} from '../../custom-index.ts';\nimport {\n    appendToArray,\n    batchArray,\n    ensureNotFalsy,\n    lastOfArray,\n    now,\n    PROMISE_RESOLVE_VOID,\n    toArray\n} from '../../plugins/utils/index.ts';\nimport { queryFoundationDB } from './foundationdb-query.ts';\nimport { INDEX_MAX } from '../../query-planner.ts';\nimport { attachmentMapKey } from '../storage-memory/index.ts';\n\nexport class RxStorageInstanceFoundationDB<RxDocType> implements RxStorageInstance<\n    RxDocType,\n    FoundationDBStorageInternals<RxDocType>,\n    RxStorageFoundationDBInstanceCreationOptions,\n    RxStorageDefaultCheckpoint\n> {\n    public readonly primaryPath: StringKeys<RxDocumentData<RxDocType>>;\n\n    public closed?: Promise<void>;\n    private changes$: Subject<EventBulk<RxStorageChangeEvent<RxDocumentData<RxDocType>>, RxStorageDefaultCheckpoint>> = new Subject();\n\n    constructor(\n        public readonly storage: RxStorageFoundationDB,\n        public readonly databaseName: string,\n        public readonly collectionName: string,\n        public readonly schema: Readonly<RxJsonSchema<RxDocumentData<RxDocType>>>,\n        public readonly internals: FoundationDBStorageInternals<RxDocType>,\n        public readonly options: Readonly<RxStorageFoundationDBInstanceCreationOptions>,\n        public readonly settings: RxStorageFoundationDBSettings\n    ) {\n        this.primaryPath = getPrimaryFieldOfPrimaryKey(this.schema.primaryKey);\n    }\n\n    async bulkWrite(\n        documentWrites: BulkWriteRow<RxDocType>[],\n        context: string\n    ): Promise<RxStorageBulkWriteResponse<RxDocType>> {\n        const dbs = await this.internals.dbsPromise;\n        const ret: RxStorageBulkWriteResponse<RxDocType> = {\n            success: [],\n            error: []\n        };\n\n        /**\n         * Doing too many write in a single transaction\n         * will throw with a 'Transaction exceeds byte limit'\n         * so we have to batch up the writes.\n         */\n        const writeBatches = batchArray(documentWrites, FOUNDATION_DB_WRITE_BATCH_SIZE);\n        await Promise.all(\n            writeBatches.map(async (writeBatch) => {\n                let categorized: CategorizeBulkWriteRowsOutput<RxDocType> | undefined = null as any;\n                await dbs.root.doTransaction(async (tx: any) => {\n                    const ids = writeBatch.map(row => (row.document as any)[this.primaryPath]);\n                    const mainTx = tx.at(dbs.main.subspace);\n                    const attachmentTx = tx.at(dbs.attachments.subspace);\n                    const docsInDB = new Map<string, RxDocumentData<RxDocType>>();\n                    /**\n                     * TODO this might be faster if fdb\n                     * any time adds a bulk-fetch-by-key method.\n                     */\n                    await Promise.all(\n                        ids.map(async (id) => {\n                            const doc = await mainTx.get(id);\n                            docsInDB.set(id, doc);\n                        })\n                    );\n                    categorized = categorizeBulkWriteRows<RxDocType>(\n                        this,\n                        this.primaryPath as any,\n                        docsInDB,\n                        writeBatch,\n                        context\n                    );\n                    appendToArray(ret.error, categorized.errors);\n\n                    // INSERTS\n                    categorized.bulkInsertDocs.forEach(writeRow => {\n                        const docId: string = writeRow.document[this.primaryPath] as any;\n                        ret.success.push(writeRow.document);\n\n                        // insert document data\n                        mainTx.set(docId, writeRow.document);\n\n                        // insert secondary indexes\n                        Object.values(dbs.indexes).forEach(indexMeta => {\n                            const indexString = indexMeta.getIndexableString(writeRow.document as any);\n                            const indexTx = tx.at(indexMeta.db.subspace);\n                            indexTx.set(indexString, docId);\n                        });\n                    });\n                    // UPDATES\n                    categorized.bulkUpdateDocs.forEach((writeRow: BulkWriteRow<RxDocType>) => {\n                        const docId: string = writeRow.document[this.primaryPath] as any;\n\n                        // overwrite document data\n                        mainTx.set(docId, writeRow.document);\n\n                        // update secondary indexes\n                        Object.values(dbs.indexes).forEach(indexMeta => {\n                            const oldIndexString = indexMeta.getIndexableString(ensureNotFalsy(writeRow.previous));\n                            const newIndexString = indexMeta.getIndexableString(writeRow.document as any);\n                            if (oldIndexString !== newIndexString) {\n                                const indexTx = tx.at(indexMeta.db.subspace);\n                                indexTx.delete(oldIndexString);\n                                indexTx.set(newIndexString, docId);\n                            }\n                        });\n                        ret.success.push(writeRow.document as any);\n                    });\n\n                    // attachments\n                    categorized.attachmentsAdd.forEach(attachment => {\n                        attachmentTx.set(\n                            attachmentMapKey(attachment.documentId, attachment.attachmentId),\n                            attachment.attachmentData\n                        );\n                    });\n                    categorized.attachmentsUpdate.forEach(attachment => {\n                        attachmentTx.set(\n                            attachmentMapKey(attachment.documentId, attachment.attachmentId),\n                            attachment.attachmentData\n                        );\n                    });\n                    categorized.attachmentsRemove.forEach(attachment => {\n                        attachmentTx.delete(\n                            attachmentMapKey(attachment.documentId, attachment.attachmentId)\n                        );\n                    });\n                });\n                categorized = ensureNotFalsy(categorized);\n                /**\n                 * The events must be emitted AFTER the transaction\n                 * has finished.\n                 * Otherwise an observable changestream might cause a read\n                 * to a document that does not already exist outside of the transaction.\n                 */\n                if (categorized.eventBulk.events.length > 0) {\n                    const lastState = ensureNotFalsy(categorized.newestRow).document;\n                    categorized.eventBulk.checkpoint = {\n                        id: lastState[this.primaryPath],\n                        lwt: lastState._meta.lwt\n                    };\n                    this.changes$.next(categorized.eventBulk);\n                }\n            })\n        );\n\n\n        return ret;\n    }\n\n    async findDocumentsById(ids: string[], withDeleted: boolean): Promise<RxDocumentData<RxDocType>[]> {\n        const dbs = await this.internals.dbsPromise;\n        return dbs.main.doTransaction(async (tx: any) => {\n            const ret: RxDocumentData<RxDocType>[] = [];\n            await Promise.all(\n                ids.map(async (docId) => {\n                    const docInDb = await tx.get(docId);\n                    if (\n                        docInDb &&\n                        (\n                            !docInDb._deleted ||\n                            withDeleted\n                        )\n                    ) {\n                        ret.push(docInDb);\n                    }\n                })\n            );\n            return ret;\n        });\n    }\n    query(preparedQuery: FoundationDBPreparedQuery<RxDocType>): Promise<RxStorageQueryResult<RxDocType>> {\n        return queryFoundationDB(this, preparedQuery);\n    }\n    async count(\n        preparedQuery: FoundationDBPreparedQuery<RxDocType>\n    ): Promise<RxStorageCountResult> {\n        /**\n         * At this point in time (end 2022), FoundationDB does not support\n         * range counts. So we have to run a normal query and use the result set length.\n         * @link https://github.com/apple/foundationdb/issues/5981\n         */\n        const result = await this.query(preparedQuery);\n        return {\n            count: result.documents.length,\n            mode: 'fast'\n        };\n    }\n    async info(): Promise<RxStorageInfoResult> {\n        const dbs = await this.internals.dbsPromise;\n        const ret: RxStorageInfoResult = {\n            totalCount: -1\n        };\n        await dbs.root.doTransaction(async (tx: any) => {\n            const mainTx = tx.at(dbs.main.subspace);\n            const range = await mainTx.getRangeAll(\n                '',\n                INDEX_MAX\n            );\n            ret.totalCount = range.length;\n        });\n        return ret;\n    }\n\n    async getAttachmentData(documentId: string, attachmentId: string, _digest: string): Promise<string> {\n        const dbs = await this.internals.dbsPromise;\n        const attachment = await dbs.attachments.get(attachmentMapKey(documentId, attachmentId));\n        return attachment.data;\n    }\n    async getChangedDocumentsSince(limit: number, checkpoint?: RxStorageDefaultCheckpoint): Promise<{ documents: RxDocumentData<RxDocType>[]; checkpoint: RxStorageDefaultCheckpoint; }> {\n        const {\n            keySelector,\n            StreamingMode\n        } = require('foundationdb');\n        const dbs = await this.internals.dbsPromise;\n        const index = [\n            '_meta.lwt',\n            this.primaryPath as any\n        ];\n        const indexName = getFoundationDBIndexName(index);\n        const indexMeta = dbs.indexes[indexName];\n        let lowerBoundString = '';\n        if (checkpoint) {\n            const checkpointPartialDoc: any = {\n                [this.primaryPath]: checkpoint.id,\n                _meta: {\n                    lwt: checkpoint.lwt\n                }\n            };\n            lowerBoundString = indexMeta.getIndexableString(checkpointPartialDoc);\n        }\n        const result: RxDocumentData<RxDocType>[] = await dbs.root.doTransaction(async (tx: any) => {\n            const innerResult: RxDocumentData<RxDocType>[] = [];\n            const indexTx = tx.at(indexMeta.db.subspace);\n            const mainTx = tx.at(dbs.main.subspace);\n            const range = await indexTx.getRangeAll(\n                keySelector.firstGreaterThan(lowerBoundString),\n                INDEX_MAX,\n                {\n                    limit,\n                    streamingMode: StreamingMode.Exact\n                }\n            );\n            const docIds = range.map((row: string[]) => row[1]);\n            const docsData: RxDocumentData<RxDocType>[] = await Promise.all(\n                docIds.map((docId: string) => mainTx.get(docId))\n            );\n            appendToArray(innerResult, docsData);\n            return innerResult;\n        });\n        const lastDoc = lastOfArray(result);\n        return {\n            documents: result,\n            checkpoint: lastDoc ? {\n                id: lastDoc[this.primaryPath] as any,\n                lwt: lastDoc._meta.lwt\n            } : checkpoint ? checkpoint : {\n                id: '',\n                lwt: 0\n            }\n        };\n    }\n    changeStream(): Observable<EventBulk<RxStorageChangeEvent<RxDocType>, RxStorageDefaultCheckpoint>> {\n        return this.changes$.asObservable();\n    }\n\n    async remove(): Promise<void> {\n        const dbs = await this.internals.dbsPromise;\n        await dbs.root.doTransaction((tx: any) => {\n            tx.clearRange('', INDEX_MAX);\n            return PROMISE_RESOLVE_VOID;\n        });\n        return this.close();\n    }\n    async cleanup(minimumDeletedTime: number): Promise<boolean> {\n        const {\n            keySelector,\n            StreamingMode\n        } = require('foundationdb');\n        const maxDeletionTime = now() - minimumDeletedTime;\n        const dbs = await this.internals.dbsPromise;\n        const index = CLEANUP_INDEX;\n        const indexName = getFoundationDBIndexName(index);\n        const indexMeta = dbs.indexes[indexName];\n        const lowerBoundString = getStartIndexStringFromLowerBound(\n            this.schema,\n            index,\n            [\n                true,\n                /**\n                 * Do not use 0 here,\n                 * because 1 is the minimum value for _meta.lwt\n                 */\n                1\n            ],\n            false\n        );\n        const upperBoundString = getStartIndexStringFromUpperBound(\n            this.schema,\n            index,\n            [\n                true,\n                maxDeletionTime\n            ],\n            true\n        );\n        let noMoreUndeleted: boolean = true;\n        await dbs.root.doTransaction(async (tx: any) => {\n            const batchSize = ensureNotFalsy(this.settings.batchSize);\n            const indexTx = tx.at(indexMeta.db.subspace);\n            const mainTx = tx.at(dbs.main.subspace);\n            const range = await indexTx.getRangeAll(\n                keySelector.firstGreaterThan(lowerBoundString),\n                upperBoundString,\n                {\n                    limit: batchSize + 1, // get one more extra to detect what to return from cleanup()\n                    streamingMode: StreamingMode.Exact\n                }\n            );\n            if (range.length > batchSize) {\n                noMoreUndeleted = false;\n                range.pop();\n            }\n            const docIds = range.map((row: string[]) => row[1]);\n            const docsData: RxDocumentData<RxDocType>[] = await Promise.all(docIds.map((docId: string) => mainTx.get(docId)));\n\n            Object\n                .values(dbs.indexes)\n                .forEach(indexMetaInner => {\n                    const subIndexDB = tx.at(indexMetaInner.db.subspace);\n                    docsData.forEach(docData => {\n                        const indexString = indexMetaInner.getIndexableString(docData);\n                        subIndexDB.delete(indexString);\n                    });\n                });\n            docIds.forEach((id: string) => mainTx.delete(id));\n        });\n\n        return noMoreUndeleted;\n    }\n\n    conflictResultionTasks(): Observable<RxConflictResultionTask<RxDocType>> {\n        return new Subject<any>().asObservable();\n    }\n    resolveConflictResultionTask(_taskSolution: RxConflictResultionTaskSolution<RxDocType>): Promise<void> {\n        return PROMISE_RESOLVE_VOID;\n    }\n\n    async close() {\n        if (this.closed) {\n            return this.closed;\n        }\n        this.closed = (async () => {\n            this.changes$.complete();\n            const dbs = await this.internals.dbsPromise;\n            await dbs.root.close();\n\n            // TODO shouldn't we close the index databases?\n            // Object.values(dbs.indexes).forEach(db => db.close());\n        })();\n        return this.closed;\n    }\n}\n\n\nexport function createFoundationDBStorageInstance<RxDocType>(\n    storage: RxStorageFoundationDB,\n    params: RxStorageInstanceCreationParams<RxDocType, RxStorageFoundationDBInstanceCreationOptions>,\n    settings: RxStorageFoundationDBSettings\n): Promise<RxStorageInstanceFoundationDB<RxDocType>> {\n    const primaryPath = getPrimaryFieldOfPrimaryKey(params.schema.primaryKey);\n\n    const {\n        open,\n        directory,\n        encoders\n    } = require('foundationdb');\n\n    const connection = open(settings.clusterFile);\n    const dbsPromise = (async () => {\n        const dir = await directory.createOrOpen(connection, 'rxdb');\n\n        const root = connection\n            .at(dir)\n            .at(params.databaseName + '.')\n            .at(params.collectionName + '.')\n            .at(params.schema.version + '.');\n        const main: FoundationDBDatabase<RxDocType> = root\n            .at('main.')\n            .withKeyEncoding(encoders.string) // automatically encode & decode keys using tuples\n            .withValueEncoding(encoders.json) as any; // and values using JSON\n\n\n        const events: FoundationDBDatabase<EventBulk<RxStorageChangeEvent<RxDocumentData<RxDocType>>, RxStorageDefaultCheckpoint>> = root\n            .at('events.')\n            .withKeyEncoding(encoders.string)\n            .withValueEncoding(encoders.json) as any;\n\n        const attachments: FoundationDBDatabase<RxAttachmentWriteData> = root\n            .at('attachments.')\n            .withKeyEncoding(encoders.string)\n            .withValueEncoding(encoders.json) as any;\n\n\n        const indexDBs: { [indexName: string]: FoundationDBIndexMeta<RxDocType>; } = {};\n        const useIndexes = params.schema.indexes ? params.schema.indexes.slice(0) : [];\n        useIndexes.push([primaryPath]);\n        const useIndexesFinal = useIndexes.map(index => {\n            const indexAr = toArray(index);\n            indexAr.unshift('_deleted');\n            return indexAr;\n        });\n        // used for `getChangedDocumentsSince()`\n        useIndexesFinal.push([\n            '_meta.lwt',\n            primaryPath\n        ]);\n        useIndexesFinal.push(CLEANUP_INDEX);\n        useIndexesFinal.forEach(indexAr => {\n            const indexName = getFoundationDBIndexName(indexAr);\n            const indexDB = root.at(indexName + '.')\n                .withKeyEncoding(encoders.string)\n                .withValueEncoding(encoders.string);\n            indexDBs[indexName] = {\n                indexName,\n                db: indexDB,\n                getIndexableString: getIndexableStringMonad(params.schema, indexAr),\n                index: indexAr\n            };\n        });\n\n        return {\n            root,\n            main,\n            events,\n            attachments,\n            indexes: indexDBs\n        };\n    })();\n\n\n    const internals: FoundationDBStorageInternals<RxDocType> = {\n        connection,\n        dbsPromise: dbsPromise\n    };\n\n    const instance = new RxStorageInstanceFoundationDB(\n        storage,\n        params.databaseName,\n        params.collectionName,\n        params.schema,\n        internals,\n        params.options,\n        settings\n    );\n    return Promise.resolve(instance);\n}\n"],"mappings":"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"}